<!DOCTYPE html>
<html lang="en">

<body>
    <table id="adminDatagrid"></table>
    <div id="newAdminDialog" hidden></div>
    <script>
        $('#adminDatagrid').datagrid({
            url: '/user/showUserList',
            columns: [
                [{
                    field: 'id',
                    hidden: true
                }, {
                    field: 'username',
                    title: '用户名',
                    align: 'center',
                    width: 100
                }, {
                    field: 'realname',
                    title: '姓名',
                    align: 'center',
                    width: 100
                }, {
                    field: 'phone',
                    title: '手机号码',
                    align: 'center',
                    width: 100
                }, {
                    field: 'address',
                    title: '地址',
                    align: 'center',
                    width: 100
                }, {
                    field: 'isAdmin',
                    title: '是否为管理员',
                    align: 'center',
                    width: 100,
                    formatter: dict.yesOrNo
                }]
            ]
        });
        var userMan = {
            addAdmin: () => {
                easyuiConfig.newDialog("newAdminDialog", '新建管理员', 280, 260, "/system/newAdmin.html", () => {
                    if ($("#newAdminForm").form('validate')) {
                        $.post("/user/addUser", $("#newAdminForm").serialize(), data => {
                            if (data != '') {
                                $.messager.alert('系统提示', '管理员' + data + '保存成功！');
                                $("#newAdminDialog").dialog('close');
                                $("#adminDatagrid").datagrid('reload');
                            } else {
                                $.messager.alert('系统提示', '管理员保存失败！');
                                $("#newAdminDialog").dialog('close');
                            }
                        });
                    }
                });
            },
            editAdmin: () => {
                let userJson = $("#adminDatagrid").datagrid('getSelected');
                if (userJson != null) {
                    easyuiConfig.newDialog("newAdminDialog", '修改管理员', 280, 185, "/system/editAdmin.html", () => {
                        if ($("#editAdminForm").form('validate')) {
                            $.post("/user/editUser", $("#editAdminForm").serialize(), data => {
                                if (data != '') {
                                    $.messager.alert('系统提示', '管理员' + data + '保存成功！');
                                    $("#newAdminDialog").dialog('close');
                                    $("#adminDatagrid").datagrid('reload');
                                } else {
                                    $.messager.alert('系统提示', '管理员保存失败！');
                                    $("#newAdminDialog").dialog('close');
                                }
                            });
                        }
                    });
                } else {
                    $.messager.alert('系统提示', '请选择要编辑的行！');
                }
            },
            deleteAdmin: () => {
                let userJson = $("#adminDatagrid").datagrid('getSelected');
                if (userJson != null) {
                    $.messager.confirm('系统提示', '你确定要删除管理员' + userJson.realname + '吗？', flag => {
                        if (flag) {
                            $.post("/user/deleteUser/" + userJson.id, data => {
                                if (data != '') {
                                    $.messager.alert('系统提示', data);
                                    $("#adminDatagrid").datagrid('reload');
                                } else {
                                    $.messager.alert('系统提示', '删除失败！');
                                }
                            });
                        }
                    });
                } else {
                    $.messager.alert('系统提示', '请选择要编辑的行！');
                }
            }
        }
        easyuiConfig.setToolbar("adminDatagrid", {
            add: userMan.addAdmin,
            edit: userMan.editAdmin,
            delete: userMan.deleteAdmin
        }, [{
            iconCls: 'icon-large-chart',
            text: '分配角色',
            handler: () => {
                alert("分配角色");
            }
        }]);
    </script>
</body>

</html>